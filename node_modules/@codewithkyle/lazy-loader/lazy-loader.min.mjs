var c=class{constructor(){this.intersectionCallback=e=>{for(let t=0;t<e.length;t++)if(e[t].isIntersecting){let s=e[t].target,i=s.tagName.toLowerCase().trim();customElements.get(i)||this.upgrade(s),this.io.unobserve(s),s.setAttribute("web-component-state","mounted")}};this.settings={cssDir:"css",jsDir:"js"},this.io=new IntersectionObserver(this.intersectionCallback)}configure(e={}){this.settings=Object.assign(this.settings,e),this.settings.cssDir=this.settings.cssDir.replace(/^\/|\/$/g,"").trim(),this.settings.jsDir=this.settings.jsDir.replace(/^\/|\/$/g,"").trim(),this.main()}update(){this.main()}css(e){return new Promise(async t=>{Array.isArray(e)||(e=[e]),e.length||t();let s=0;for(let i=0;i<e.length;i++){let n=e[i],a;n.indexOf("https://")===0||n.indexOf("http://")===0||n.indexOf("./")===0||n.indexOf("../")===0||n.indexOf("/")===0?a=n:a=`${location.origin}/${this.settings.cssDir}/${n.replace(/\.css$/g,"").trim()}.css`;let o=document.head.querySelector(`link[href="${a}"]`);o?(s++,s===e.length&&t()):new Promise(l=>{o=document.createElement("link"),o.href=a,o.rel="stylesheet",o.onload=()=>{l()},o.onerror=()=>{l()},document.head.appendChild(o)}).then(()=>{s++,s===e.length&&t()})}})}async mount(e,t=null){if(!customElements.get(e)){if(t===null)try{let s=`${location.origin}/${this.settings.jsDir}/${e}.js`;t=await this.loadModule(s)}catch(s){throw console.error(s),s}customElements.define(e,t)}}collectLazyCSS(){let e=[],t=Array.from(document.body.querySelectorAll("[css]"));for(let s=0;s<t.length;s++){let n=t[s].getAttribute("css").trim().replace(/\s+/," ").split(" ");e=[...e,...n],t[s].removeAttribute("css")}return Array.from(new Set(e))}collectCustomElements(){let e=[],t=Array.from(document.body.querySelectorAll("[web-component]:not([web-component-state])"));for(let s=0;s<t.length;s++)t[s].setAttribute("web-component-state","tracked"),e.push(t[s]);return e}async loadModule(e){let t=await import(e);if(!t?.default){let s=Object.keys(t)?.[0]??null;if(!s)throw"ES Module is exporting an empty object.";t=Object.assign({default:t[s]},t)}return t.default}getModuleUrl(e,t){let s=`${location.origin}/${this.settings.jsDir}/${t}.js`,i=e.getAttribute("web-component");return i!==""&&(i.indexOf("https://")===0||i.indexOf("http://")===0||i.indexOf("./")===0||i.indexOf("../")===0||i.indexOf("/")===0?s=i:s=`${location.origin}/${this.settings.jsDir}/${i.replace(/^\//g,"").trim()}`),s}async upgrade(e){try{let t=e.tagName.toLowerCase().trim(),s=this.getModuleUrl(e,t),i=await this.loadModule(s);this.mount(t,i)}catch(t){console.error(t)}}async upgradeOrTrack(e){for(let t of e)t.getAttribute("loading")==="eager"?(await this.upgrade(t),t.setAttribute("web-component-state","mounted")):this.io.observe(t)}async main(){let e=this.collectLazyCSS();await this.css(e);let t=this.collectCustomElements();this.upgradeOrTrack(t)}},r=new c,d=r.configure.bind(r),g=r.update.bind(r),h=r.mount.bind(r),p=r.css.bind(r);export{d as configure,p as css,h as mount,g as update};
